<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do — Minimal, Fast, Local</title>
  <meta name="description" content="A fast, offline to‑do app with localStorage sync." />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <style>
    :root{
      --bg:#0b0f14; --card:#121821; --muted:#7a8699; --text:#e6edf3; --accent:#6aa9ff;
      --accent-2:#87f3c4; --danger:#ff6b6b; --ok:#73f59f; --ring: 0 0 0 2px rgba(106,169,255,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      background: radial-gradient(1000px 600px at 80% -10%, rgba(135,243,196,.06), transparent 60%),
                  radial-gradient(800px 500px at 20% 110%, rgba(106,169,255,.08), transparent 60%),
                  var(--bg);
      color:var(--text);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{
      width: min(920px, 100%);
      display:grid; gap:16px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    h1{margin:0; font-size:clamp(22px,4vw,32px); letter-spacing:.2px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid #223041; padding:8px 12px; border-radius:999px; color:var(--muted);
      backdrop-filter: blur(6px);
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%), var(--card);
      border:1px solid #1f2a38; border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .row{display:flex; gap:10px; align-items:center}
    .toolbar{padding:12px}
    input[type="text"], input[type="search"], input[type="date"]{
      background:#0e141c; color:var(--text); border:1px solid #233349; padding:12px 14px;
      border-radius:12px; outline:none; width: 100%;
    }
    input[type="text"]:focus, input[type="search"]:focus, input[type="date"]:focus{ box-shadow: var(--ring); border-color:#2c4b77}
    button{
      background:#17202c; color:var(--text); border:1px solid #223041; padding:12px 14px;
      border-radius:12px; cursor:pointer;
    }
    button:hover{ background:#1b2838 }
    button.primary{ background:linear-gradient(180deg, #1f3b63, #162945); border-color:#2d4a77}
    button.ghost{ background:transparent }
    button.danger{ border-color:#3b2121; background:#231416 }
    .controls{display:flex; flex-wrap:wrap; gap:10px}
    .list{ list-style:none; margin:0; padding:0; }
    .item{
      display:grid; grid-template-columns: auto 1fr auto; gap:12px; align-items:center;
      padding:14px 16px; border-top:1px solid #1b2533;
    }
    .item:first-child{ border-top: none }
    .checkbox{
      width:22px; height:22px; border:1px solid #2b3d56; border-radius:7px; display:grid; place-content:center; cursor:pointer;
      background:#0e141c;
    }
    .checkbox.done{ background:#0e1a14; border-color:#254b39 }
    .checkbox svg{width:16px; height:16px}
    .title{ font-size:16px; }
    .title.done{ text-decoration:line-through; color:#8ea0b8 }
    .due{ font-size:12px; color:var(--muted); }
    .tags{ display:flex; gap:6px; flex-wrap:wrap }
    .tag{ font-size:12px; padding:2px 8px; border:1px solid #223041; border-radius:999px; color:#9fb0c8 }
    .actions{ display:flex; gap:8px; }
    .footer{
      display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 16px; border-top:1px solid #1b2533; color:var(--muted);
      flex-wrap:wrap;
    }
    .filters{ display:flex; gap:8px; }
    .filters button[aria-pressed="true"]{ outline: none; box-shadow: var(--ring); }
    .empty{ padding:28px; text-align:center; color:#90a3bf }
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .edit{
      width:100%; background:#0e141c; color:var(--text); border:1px dashed #2c4361; padding:10px 12px; border-radius:10px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>To‑Do</h1>
      <div class="pill" id="stats" aria-live="polite">0 total • 0 left</div>
    </header>

    <section class="card toolbar" aria-label="Add a task">
      <form id="addForm" class="row" autocomplete="off">
        <input id="title" type="text" placeholder="Add a task… (e.g., Submit report)" required />
        <input id="date" type="date" aria-label="Due date" />
        <input id="tags" type="text" placeholder="tags (comma‑separated)" aria-label="Tags" />
        <button class="primary" type="submit" aria-label="Add task">Add</button>
      </form>
      <div class="controls" style="margin-top:10px">
        <input id="search" type="search" placeholder="Search…">
        <div class="filters" role="tablist" aria-label="Filter tasks">
          <button data-filter="all" aria-pressed="true">All</button>
          <button data-filter="active" aria-pressed="false">Active</button>
          <button data-filter="completed" aria-pressed="false">Completed</button>
          <button id="clearDone" class="ghost">Clear completed</button>
        </div>
        <button id="exportBtn" title="Download your tasks as JSON">Export</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button id="importBtn" class="ghost" title="Import tasks from JSON">Import</button>
      </div>
    </section>

    <section class="card" aria-label="Tasks">
      <ul id="list" class="list" role="list"></ul>
      <div id="empty" class="empty">No tasks yet. Add one above ✨</div>
      <div class="footer">
        <span id="hint">Tips: press Enter to add • Double‑click a task to edit • Use tags like <code>work,urgent</code></span>
        <span id="clock" aria-live="polite"></span>
      </div>
    </section>
  </div>

  <template id="itemTemplate">
    <li class="item">
      <button class="checkbox" aria-label="Toggle done" title="Toggle">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <div>
        <div class="title"></div>
        <div class="row" style="gap:8px;margin-top:6px">
          <div class="due"></div>
          <div class="tags"></div>
        </div>
      </div>
      <div class="actions">
        <button class="ghost editBtn" title="Edit">Edit</button>
        <button class="danger deleteBtn" title="Delete">Delete</button>
      </div>
    </li>
  </template>

  <script>
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

    const LS_KEY = "todo.minimal.v1";
    let state = load();

    const els = {
      stats: $("#stats"),
      list: $("#list"),
      empty: $("#empty"),
      addForm: $("#addForm"),
      title: $("#title"),
      date: $("#date"),
      tags: $("#tags"),
      search: $("#search"),
      filters: $$(".filters button"),
      clearDone: $("#clearDone"),
      exportBtn: $("#exportBtn"),
      importBtn: $("#importBtn"),
      importFile: $("#importFile"),
      clock: $("#clock"),
    };

    function uid(){ return Math.random().toString(36).slice(2,10) }
    function load(){
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || { items:[], filter:"all", q:"" } }
      catch{ return { items:[], filter:"all", q:"" } }
    }
    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)) }

    function addItem(title, due=null, tags=[]) {
      state.items.unshift({ id:uid(), title:title.trim(), done:false, due, tags });
      save(); render();
    }

    function deleteItem(id){
      state.items = state.items.filter(i => i.id !== id);
      save(); render();
    }
    function toggleItem(id){
      const it = state.items.find(i => i.id===id);
      if(!it) return;
      it.done = !it.done;
      save(); render();
    }
    function updateItem(id, patch){
      const it = state.items.find(i => i.id===id);
      if(!it) return;
      Object.assign(it, patch);
      save(); render();
    }

    function render(){
      const q = state.q.trim().toLowerCase();
      const filter = state.filter;
      const items = state.items.filter(i => {
        const matchesQ = !q || i.title.toLowerCase().includes(q) || i.tags.some(t=>t.includes(q));
        const matchesF = filter==="all" ? true : filter==="active" ? !i.done : i.done;
        return matchesQ && matchesF;
      });

      els.list.innerHTML = "";
      items.forEach(it => {
        const node = document.importNode($("#itemTemplate").content, true);
        const li = node.querySelector(".item");
        const checkbox = node.querySelector(".checkbox");
        const title = node.querySelector(".title");
        const due = node.querySelector(".due");
        const tags = node.querySelector(".tags");
        const del = node.querySelector(".deleteBtn");
        const editBtn = node.querySelector(".editBtn");

        title.textContent = it.title;
        title.classList.toggle("done", it.done);
        checkbox.classList.toggle("done", it.done);

        due.textContent = it.due ? ("Due " + new Date(it.due).toLocaleDateString()) : "";
        tags.innerHTML = it.tags.map(t=>`<span class="tag">#${escapeHtml(t)}</span>`).join("");

        checkbox.addEventListener("click", ()=>toggleItem(it.id));
        del.addEventListener("click", ()=>deleteItem(it.id));

        // Inline edit on double click or Edit button
        function startEdit(){
          const input = document.createElement("input");
          input.className = "edit";
          input.value = it.title;
          title.replaceWith(input);
          input.focus();
          input.addEventListener("keydown", e=>{
            if(e.key==="Enter"){ finishEdit(input.value) }
            if(e.key==="Escape"){ render() }
          });
          input.addEventListener("blur", ()=>finishEdit(input.value));
          function finishEdit(val){
            const v = (val||"").trim();
            if(v){ updateItem(it.id, {title:v}) } else { render(); }
          }
        }
        title.addEventListener("dblclick", startEdit);
        editBtn.addEventListener("click", startEdit);

        els.list.appendChild(node);
      });

      els.empty.style.display = items.length ? "none" : "block";

      const total = state.items.length;
      const left = state.items.filter(i=>!i.done).length;
      els.stats.textContent = `${total} total • ${left} left`;
      els.filters.forEach(btn => btn.setAttribute("aria-pressed", String(btn.dataset.filter===state.filter)));
    }

    function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])) }

    // Add form
    els.addForm.addEventListener("submit", e => {
      e.preventDefault();
      const title = els.title.value;
      const due = els.date.value || null;
      const tags = (els.tags.value||"").split(",").map(s=>s.trim()).filter(Boolean);
      if(title.trim()){ addItem(title, due, tags) }
      e.target.reset();
      els.title.focus();
    });

    // Filters
    els.filters.forEach(btn => btn.addEventListener("click", () => {
      if(btn.id==="clearDone"){
        state.items = state.items.filter(i=>!i.done);
      } else {
        state.filter = btn.dataset.filter;
      }
      save(); render();
    }));

    // Search
    els.search.addEventListener("input", e => { state.q = e.target.value; save(); render(); });

    // Export / Import
    els.exportBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(state.items, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "todos.json";
      a.click();
      URL.revokeObjectURL(url);
    });
    els.importBtn.addEventListener("click", () => els.importFile.click());
    els.importFile.addEventListener("change", e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const items = JSON.parse(reader.result);
          if(Array.isArray(items)){
            state.items = items.map(it => ({
              id: it.id || uid(),
              title: String(it.title||"").trim(),
              done: Boolean(it.done),
              due: it.due || null,
              tags: Array.isArray(it.tags) ? it.tags.map(String) : []
            }));
            save(); render();
          }
        } catch {}
      };
      reader.readAsText(file);
    });

    // Live clock
    function tick(){
      const now = new Date();
      els.clock.textContent = now.toLocaleString();
    }
    setInterval(tick, 1000); tick();

    // Keyboard: Enter focuses title
    document.addEventListener("keydown", e=>{
      if(e.key==="n" && (e.ctrlKey||e.metaKey)){ e.preventDefault(); els.title.focus(); }
    });

    // First render
    render();
  </script>
</body>
</html>
